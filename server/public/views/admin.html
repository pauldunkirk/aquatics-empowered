<!-- <nav ng-include="'views/templates/nav.html'"></nav> -->
<div class="container">
<!-- ******************************************************* -->
  <div class="row">
    <h2>Admin Page - Running on {{vm.dbType}} database</h2>
  </div>
  <hr>
  <!-- ************************ Search ******************************* -->
  <div class="row"> <!-- Begin Pool Search-->

    <form ng-submit="vm.poolSearch()" class="center-block text-center">
      <input ng-model="vm.addr" type="text" class="btn btn-lg myBorder" placeholder="CITY OR ZIP CODE"/>
      <button type="submit" class="btn btn-lg myBorder yellowBackground">GET POOLS</button>
    </form>

  </div> <!-- End Pool Search-->

<!-- ************************Cities Table Setup ******************************* -->
  <div class="row">
    <h3>Choose which of 1000 biggest cities in USA to search</h3>
    <h4>Results: {{(vm.cityTable.cityList  | filter: cityQuery | excludeByStatus:vm.cityTable.show.text()).length}}</h4>
    <form>
      <input class="form-control" placeholder="enter city or state to filter" ng-model="cityQuery" ng-change="vm.cityTable.pageCheck((vm.cityTable.cityList  | filter: cityQuery |  excludeByStatus: vm.cityTable.show.text()).length)" />
      <div></div>
    </form>
    <span>click column heading to sort</span>
  </div>
<!-- ******************** Cities Table *********************************** -->
  <div class="row">
    <div class="col-md-6">
      <table style="background: white" class="table table-bordered table-hover table-condensed table-responsive">
        <thead>
          <tr class="headerRow">
            <th class="columnSort" width="55" ng-click="vm.cityTable.setSort('include')">Select&nbsp</th>
            <th class="columnSort" ng-click="vm.cityTable.setSort('city')">City</th>
            <th class="columnSort" ng-click="vm.cityTable.setSort('state')">State</th>
          </tr>
        </thead>
        <tbody class="tableBody">
          <tr class="tableBodyRow" data-ng-repeat="res in vm.cityTable.cityList | excludeByStatus: vm.cityTable.show.text() | orderBy:vm.cityTable.sortType:vm.cityTable.sortReverse | filter: cityQuery | startFrom:vm.cityTable.currentPage*vm.cityTable.pageSize | limitTo:vm.cityTable.pageSize" >
            <td><input type="checkbox" ng-model="res.include" /></td>
            <td class="longTd">{{res.city}}</td>
            <td class="longTd">{{res.state}}</td>
          </tr>
        </tbody>
      </table>
      <div class="row" ng-show="vm.cityTable.totalPages((vm.cityTable.cityList  | filter: query |  excludeByStatus: vm.cityTable.show.text()).length)" >
        <button ng-class="mini" ng-disabled="vm.cityTable.currentPage == 0" ng-click="vm.cityTable.currentPage=vm.cityTable.currentPage-1">
          Previous
        </button>
          {{vm.cityTable.currentPage+1}}/{{vm.cityTable.totalPages((vm.cityTable.cityList  | filter: query | excludeByStatus: vm.cityTable.show.text()).length)}}
        <button ng-class="mini" ng-disabled="vm.cityTable.currentPage >= ((vm.cityTable.cityList  | filter: cityQuery | excludeByStatus: vm.cityTable.show.text()).length / vm.cityTable.pageSize - 1)" ng-click="vm.cityTable.currentPage=vm.cityTable.currentPage+1">
          Next
        </button>
      </div>
    </div>
  </div>  <!-- end cities table -->


<!-- ******************************************************* -->
  <div class="row">
    <h4>Takes city coordinates, gets google Place IDs and Coordinates for up to 200 places per city - based on keywords (for example, public swimming pool for swimming -services -suppliers -supply -supplier -contractor -repair -installation) and adds to Radar Table</h4>

<!-- ***** citiesRadarSearch   add geolocate ****-->
    <form class="specialTools form-group" ng-submit="vm.googlePlaces.citiesRadarSearch(num)">
      <input class="form-control" type="text" placeholder="keywords" required ng-disabled="vm.citiesLeft[0]" ng-model="vm.keywords">
      <input class="form-control" type="text" required ng-model="vm.cityCoordsUrl">
      <input class="btn" type="submit" value="Radar search selected cities, post coords and place_id to Radar Table" ng-disabled="!(vm.keywords)">
    </form>


    <h4 ng-if="vm.citiesLeft[0]">
      {{vm.citiesLeft[0]}} cities remaining <br />
      {{vm.errorCount}} errors
    </h4>
  </div>
<!-- ******************************************************* -->
<hr>
  <div class="row">
    <h2>Gather Details</h2>
    <h4>Gathers detailed info with the Google Place Ids from above</h4>

    <button class="btn-danger" ng-click="vm.db.cleanIdList()">
       Delete placeIds that already exist in facilities table
    </button><br/>

    <button class="btn" ng-click="vm.googlePlaces.getPlaceIdList()">
      Get ALL (place ids and coord) from Radar Table
    </button><br/>



    <!-- WORKING BUTTON  <button class="btn"
        ng-disabled="!vm.placeIdsFromRadarTable.length"
        ng-click="vm.googlePlaces.getInfoFromIds(vm.placeIdsFromRadarTable)">
      {{vm.placeIdsFromRadarTable.length ? "Add Google Info for ALL Place Ids to facilities table! (uses 1 API query per Place Id)" : "Need to get Place Ids first"}}
    </button> -->


    <button class="btn" ng-click="vm.googlePlaces.getInfoFromIds(vm.placeIdsFromRadarTable)">
     Add Google Info for ALL Place Ids to facilities table! (uses 1 API query per Place Id)
    </button>



    <span>Current API query limit 2k per day</span>
    <h4>Number of google Place Ids: {{vm.placeIdsFromRadarTable.length}}</h4>
    <h4 ng-if="vm.placesLeft[0]">
      {{vm.placesLeft[0]}} places remaining <br />
      {{vm.errorCount}} errors
    </h4>
  </div>
<!-- ******************************************************* -->
<hr>
  <div class="row">
    <h3>Stop Queries!</h3>
    <button class="btn" ng-disabled="!vm.pulsing" ng-click="vm.abort=true">
      Stop pulsing all Google queries
    </button>
  </div>
<hr>
<!-- ******************************************************* -->
  <div class="row">
    <h4><br />{{vm.dbType}} Database, RADAR table:</h4>
    <button class="btn-danger" ng-click="vm.db.deleteAllRadarTable()">
      Delete ALL from Radar Table
    </button>
    <!-- <h4><br />{{vm.dbType}} Database, FACILITIES table:</h4> -->
  </div>
  <hr>
<!-- **********DATABASE VIEW table set up*** -->
  <div class="row">
    <h2>Database View</h2>
    <form>
      <label>Search Pools in Database</label>
      <input ng-model="query" ng-change="vm.pageCheck((vm.allPools  | filter: query |  excludeByStatus: vm.show.text()).length, vm.current)"/>
      <div></div>
    </form>
    <h3>Results: {{(vm.allPools  | filter: query | excludeByStatus: vm.show.text()).length}} </h3>
    <span>click column heading to sort</span>
  </div>
  <!-- end DATABASE VIEW table set up -->
<!-- ******************************************************* -->
  <!-- DATABASE VIEW table itself -->
  <div class="row">
    <table style="background: white" class="table table-bordered table-hover table-condensed table-responsive">
      <thead>
        <tr class="headerRow">
          <th class="columnSort" ng-click="vm.setSort('id')">Id#</th>
          <th class="columnSort" ng-click="vm.setSort('name')">Name</th>
          <th class="columnSort" ng-click="vm.setSort('city')">City</th>
          <th class="columnSort" ng-click="vm.setSort('state')">State</th>
          <th class="columnSort" ng-click="vm.setSort('keyword')">Keyword</th>
          <!-- <th class="columnSort" ng-click="vm.setSort('google_places_data.rating')">Rating</th>
          <th class="columnSort" ng-click="vm.setSort('google_places_data.reviews.length')">#of Revs</th>
          <th class="columnSort" ng-click="vm.setSort('last_updated')">Changed</th> -->
          <th class="columnSort" ng-click="vm.setSort('date_added')">Added</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr data-ng-repeat="result in vm.allPools | excludeByStatus: vm.show.text() | orderBy:vm.sortType:vm.sortReverse | filter: query | startFrom:vm.currentPage*vm.pageSize | limitTo:vm.pageSize">
          <td>{{result.id}}</td>
          <td class="columnSort" ng-click="vm.log(result.google_places_data)">{{result.name}}</td>
          <td>{{result.city}}</td>
          <td>{{result.state}}</td>
          <td style:"max-width:100px">{{result.keyword}}</td>
          <!-- <td>{{result.google_places_data.rating}}</td> -->
          <!-- <td>{{result.google_places_data.reviews.length || 0}}</td> -->
          <!-- <td>{{result.last_updated | date:'medium'}}</td> -->
          <td>{{result.date_added | date:'medium' }}</td>
          <td><div>
            <i ng-click="vm.db.deleteFacility(result.id)" class="fa fa-trash" />
          </div></td>
        </tr>
      </tbody>
    </table>
  </div> <!-- end DATABASE VIEW table itself -->
<!-- ******************************************************* -->
  <!-- DATABASE VIEW TABLE controls -->
  <div class="row" ng-show="vm.totalPages((vm.allPools  | filter: query |  excludeByStatus: vm.show.text()).length)">

    <button ng-class="mini" ng-disabled="vm.currentPage == 0" ng-click="vm.currentPage=vm.currentPage-1">
      Previous
    </button>

      {{vm.currentPage+1}}/{{vm.totalPages((vm.allPools  | filter: query | excludeByStatus: vm.show.text()).length)}}

    <button ng-class="mini" ng-disabled="vm.currentPage >= ((vm.allPools  | filter: query | excludeByStatus: vm.show.text()).length / vm.pageSize - 1)" ng-click="vm.currentPage=vm.currentPage+1">
      Next
    </button>

  </div>  <!-- end DATABASE VIEW TABLE controls -->
<!-- ******************************************************* -->
</div> <!-- end page container -->
